{% extends 'base_admin.html' %}

{% block content %}
<div class="container-fluid mt-4"> <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Movimientos de Inventario</h2>
        <div>
             <a href="{% url 'inventario:stock_list' %}" class="btn btn-outline-secondary me-2">
                <i class="fas fa-boxes me-1"></i> Ver Stock Actual
            </a>
            <a href="{% url 'inventario:create' %}" class="btn btn-primary">
                <i class="fas fa-plus me-1"></i> Registrar Movimiento
            </a>
        </div>
    </div>

    <form method="get" class="card p-3 mb-4">
        <div class="row g-2 align-items-end">
            <div class="col-md-2"><label>Tipo:</label><select name="tipo" class="form-select form-select-sm"><option value="">Todos</option>{# Llenar con tipos #}</select></div>
            <div class="col-md-2"><label>Producto:</label><input type="text" name="producto" class="form-control form-control-sm" placeholder="SKU o Nombre"></div>
            <div class="col-md-2"><label>Bodega:</label><select name="bodega" class="form-select form-select-sm"><option value="">Todas</option>{# Llenar con bodegas #}</select></div>
            <div class="col-md-2"><label>Desde:</label><input type="date" name="fecha_desde" class="form-control form-control-sm"></div>
            <div class="col-md-2"><label>Hasta:</label><input type="date" name="fecha_hasta" class="form-control form-control-sm"></div>
            <div class="col-md-2"><button type="submit" class="btn btn-secondary btn-sm w-100">Filtrar</button></div>
        </div>
    </form>

    <div class="table-responsive">
        <table class="table table-striped table-hover table-sm">
            <thead class="table-dark">
                <tr>
                    <th>Fecha</th>
                    <th>Tipo</th>
                    <th>Producto (SKU)</th>
                    <th>Cantidad</th>
                    <th>UdM</th>
                    <th>Bodega</th>
                    <th>Lote</th>
                    <th>Serie</th>
                    <th>Vence</th>
                    <th>Doc Ref</th>
                    <th>Usuario</th>
                    </tr>
            </thead>
            <tbody>
                {% for mov in movements %}
                <tr class="{% if not mov.movement_type.is_entry %}table-danger{% else %}table-success{% endif %}">
                    <td>{{ mov.timestamp|date:"Y-m-d H:i" }}</td>
                    <td>{{ mov.movement_type.name }}</td>
                    <td>{{ mov.product.name }} ({{ mov.product.sku }})</td>
                    <td class="text-end fw-bold">{{ mov.quantity|floatformat:2 }}</td>
                    <td>{{ mov.uom.code }}</td>
                    <td>{{ mov.warehouse.name }}</td>
                    <td>{{ mov.lot_number|default:"-" }}</td>
                    <td>{{ mov.serial_number|default:"-" }}</td>
                    <td>{{ mov.expiry_date|date:"Y-m-d"|default:"-" }}</td>
                    <td>{{ mov.doc_reference|default:"-" }}</td>
                    <td>{{ mov.created_by.username|default:"N/A" }}</td>
                    </tr>
                {% empty %}
                <tr><td colspan="11" class="text-center">No hay movimientos registrados.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    </div>
{% endblock %}