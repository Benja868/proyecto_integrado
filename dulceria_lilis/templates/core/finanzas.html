{% extends 'base_admin.html' %}
{% load humanize %}

{% block content %}
<div class="container-fluid mt-4" style="max-height: 100vh; overflow-y: auto;">

    <h2 class="mb-3 text-danger">
        <i class="fas fa-wallet me-2"></i> Finanzas
    </h2>

    <div class="row">
        <!-- Columna izquierda -->
        <div class="col-lg-4">
            <div class="card mb-3 shadow-sm">
                <div class="card-header bg-danger text-white">
                    <i class="fas fa-plus-circle me-1"></i> Nuevo registro
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        {{ form.as_p }}
                        <button class="btn btn-danger w-100" type="submit">
                            <i class="fas fa-save me-1"></i> Guardar
                        </button>
                    </form>
                </div>
            </div>

            <div class="card shadow-sm">
                <div class="card-header bg-secondary text-white">
                    <i class="fas fa-chart-line me-1"></i> Resumen
                </div>
                <div class="card-body">
                    <p><strong>Ingresos:</strong> ${{ total_ingresos|intcomma }}</p>
                    <p><strong>Gastos:</strong> ${{ total_gastos|intcomma }}</p>
                    <hr>
                    <p><strong>Balance:</strong> ${{ balance|intcomma }}</p>
                </div>
            </div>
        </div>

        <!-- Columna derecha -->
        <div class="col-lg-8">
            {% include 'partials/search_bar.html' %}
            <div class="card shadow-sm">
                <div class="card-header bg-danger text-white">
                    <i class="fas fa-list me-1"></i> Listado
                </div>
                <div class="card-body p-0" style="max-height: 60vh; overflow-y: auto;">
                    <div class="table-responsive">
                        <table class="table table-striped mb-0 align-middle">
                            <thead class="table-danger text-center">
                                <tr>
                                    <th>#</th>
                                    <th>Descripci√≥n</th>
                                    <th>Ingreso</th>
                                    <th>Gasto</th>
                                    <th>Fecha</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for r in page_obj %}
                                    <tr class="text-center">
                                        <td>{{ r.id }}</td>
                                        <td class="text-start">{{ r.descripcion }}</td>
                                        <td>${{ r.ingreso|intcomma }}</td>
                                        <td>${{ r.gasto|intcomma }}</td>
                                        <td>{{ r.fecha }}</td>
                                    </tr>
                                {% empty %}
                                    <tr>
                                        <td colspan="5" class="text-center text-muted py-3">
                                            <i class="fas fa-info-circle me-1"></i> Sin registros
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="mt-3">
                {% include 'partials/pagination.html' %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

{% if messages %}
<script>
document.addEventListener("DOMContentLoaded", () => {
    const messages = JSON.parse(`[
        {% for message in messages %}
            {"level": "{{ message.tags }}", "text": "{{ message|escapejs }}"}{% if not forloop.last %},{% endif %}
        {% endfor %}
    ]`);

    messages.forEach(msg => {
        Swal.fire({
            title: msg.level.charAt(0).toUpperCase() + msg.level.slice(1),
            text: msg.text,
            icon: msg.level,
            confirmButtonColor: '#a71f1f',
            background: '#fff',
            showClass: { popup: 'animate__animated animate__fadeInDown' },
            hideClass: { popup: 'animate__animated animate__fadeOutUp' }
        });
    });
});
</script>
{% endif %}
{% endblock %}
